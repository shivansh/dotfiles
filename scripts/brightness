#!/bin/bash

die(){
  echo "$@"
  exit 1
}

# Check for root priviledges
[ "$(id -u)" != "0" ] && {
  sudo "$0" "$@"
  exit $?
}

[ $# -ne 1 ] && die "USAGE: brightness <integer>"

brightness_directory="/sys/class/backlight/intel_backlight"

##########################
## Compatibility checks ##
##########################

# if [ -d /sys/class/backlight/intel_backlight ]; then
#   brightness_directory="/sys/class/backlight/intel_backlight"
# elif [ -d /sys/class/blacklight/acpi_video0 ]; then
#   brightness_directory="/sys/class/backlight/acpi_video0"
# else
#   die "Can't determine backlight controller"
# fi

current_brightness=$(cat $brightness_directory/brightness)
max_brightness=$(cat $brightness_directory/max_brightness)
brightness=$1
brightness=$((current_brightness + brightness))

if [[ $brightness -lt 0 ]]; then
  brightness=0
elif [[ $brightness -gt $max_brightness ]]; then
  brightness=$max_brightness
fi

echo "$brightness" > "$brightness_directory/brightness"
